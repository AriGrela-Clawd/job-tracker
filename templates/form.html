{% extends "base.html" %}

{% block title %}{{ titulo }} - Job Application Tracker{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1><i class="fas fa-{% if postulacion %}edit{% else %}plus-circle{% endif %}"></i> {{ titulo }}</h1>
        {% if postulacion %}
        <a href="/postulaciones/{{ postulacion.id }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
        {% else %}
        <a href="/postulaciones" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Volver
        </a>
        {% endif %}
    </div>

    <div class="form-card">
        <form method="post" class="postulacion-form">
            <!-- Row 1: Basic Info -->
            <div class="form-row">
                <div class="form-group form-group-large">
                    <label for="empresa">
                        <i class="fas fa-building"></i> Empresa *
                    </label>
                    <input type="text" id="empresa" name="empresa" required
                           value="{{ postulacion.empresa if postulacion else '' }}"
                           placeholder="Nombre de la empresa">
                </div>
                
                <div class="form-group form-group-large">
                    <label for="puesto">
                        <i class="fas fa-briefcase"></i> Puesto *
                    </label>
                    <input type="text" id="puesto" name="puesto" required
                           value="{{ postulacion.puesto if postulacion else '' }}"
                           placeholder="Título del puesto">
                </div>
            </div>

            <!-- Row 2: URL and Status -->
            <div class="form-row">
                <div class="form-group form-group-large">
                    <label for="url_oferta">
                        <i class="fas fa-link"></i> URL de la oferta
                    </label>
                    <input type="url" id="url_oferta" name="url_oferta"
                           value="{{ postulacion.url_oferta if postulacion else '' }}"
                           placeholder="https://...">
                </div>
                
                <div class="form-group">
                    <label for="estado">
                        <i class="fas fa-tag"></i> Estado *
                    </label>
                    <select id="estado" name="estado" required>
                        {% for e in estados %}
                        <option value="{{ e }}" {% if postulacion and postulacion.estado == e %}selected{% endif %}>
                            {{ e }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Row 3: Dates -->
            <div class="form-row">
                <div class="form-group">
                    <label for="fecha_postulacion">
                        <i class="fas fa-calendar"></i> Fecha de postulación *
                    </label>
                    <input type="date" id="fecha_postulacion" name="fecha_postulacion" required
                           value="{{ postulacion.fecha_postulacion.strftime('%Y-%m-%d') if postulacion and postulacion.fecha_postulacion else hoy }}">
                </div>
                
                <div class="form-group">
                    <label for="fecha_seguimiento">
                        <i class="fas fa-bell"></i> Fecha de seguimiento
                    </label>
                    <input type="date" id="fecha_seguimiento" name="fecha_seguimiento"
                           value="{{ postulacion.fecha_seguimiento.strftime('%Y-%m-%d') if postulacion and postulacion.fecha_seguimiento else '' }}">
                    <small class="form-help">Fecha para recordar hacer seguimiento</small>
                </div>
                
                {% if postulacion %}
                <div class="form-group">
                    <label for="fecha_respuesta">
                        <i class="fas fa-reply"></i> Fecha de respuesta
                    </label>
                    <input type="date" id="fecha_respuesta" name="fecha_respuesta"
                           value="{{ postulacion.fecha_respuesta.strftime('%Y-%m-%d') if postulacion.fecha_respuesta else '' }}">
                </div>
                {% endif %}
            </div>

            <!-- Row 4: Location and Modality -->
            <div class="form-row">
                <div class="form-group">
                    <label for="ubicacion">
                        <i class="fas fa-map-marker-alt"></i> Ubicación
                    </label>
                    <input type="text" id="ubicacion" name="ubicacion"
                           value="{{ postulacion.ubicacion if postulacion else '' }}"
                           placeholder="Ciudad / País">
                </div>
                
                <div class="form-group">
                    <label for="modalidad">
                        <i class="fas fa-laptop-house"></i> Modalidad
                    </label>
                    <select id="modalidad" name="modalidad">
                        <option value="">Seleccionar...</option>
                        <option value="Remoto" {% if postulacion and postulacion.modalidad == 'Remoto' %}selected{% endif %}>Remoto</option>
                        <option value="Híbrido" {% if postulacion and postulacion.modalidad == 'Híbrido' %}selected{% endif %}>Híbrido</option>
                        <option value="Presencial" {% if postulacion and postulacion.modalidad == 'Presencial' %}selected{% endif %}>Presencial</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="salario_ofrecido">
                        <i class="fas fa-dollar-sign"></i> Salario
                    </label>
                    <input type="text" id="salario_ofrecido" name="salario_ofrecido"
                           value="{{ postulacion.salario_ofrecido if postulacion else '' }}"
                           placeholder="Ej: 50K - 70K USD">
                </div>
            </div>

            <!-- Row 5: Contact -->
            <div class="form-row">
                <div class="form-group">
                    <label for="contacto_nombre">
                        <i class="fas fa-user"></i> Contacto
                    </label>
                    <input type="text" id="contacto_nombre" name="contacto_nombre"
                           value="{{ postulacion.contacto_nombre if postulacion else '' }}"
                           placeholder="Nombre del reclutador">
                </div>
                
                <div class="form-group">
                    <label for="contacto_email">
                        <i class="fas fa-envelope"></i> Email contacto
                    </label>
                    <input type="email" id="contacto_email" name="contacto_email"
                           value="{{ postulacion.contacto_email if postulacion else '' }}"
                           placeholder="email@empresa.com">
                </div>
                
                <div class="form-group">
                    <label for="tags">
                        <i class="fas fa-tags"></i> Tags
                    </label>
                    <input type="text" id="tags" name="tags"
                           value="{{ postulacion.tags if postulacion else '' }}"
                           placeholder="python, senior, fintech">
                    <small class="form-help">Separados por comas</small>
                </div>
            </div>

            <!-- Row 6: Notes -->
            <div class="form-group form-group-full">
                <label for="notas">
                    <i class="fas fa-sticky-note"></i> Notas
                </label>
                <textarea id="notas" name="notas" rows="5" 
                          placeholder="Notas sobre la postulación, feedback recibido, detalles importantes...">{{ postulacion.notas if postulacion else '' }}</textarea>
            </div>

            <!-- Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i> 
                    {% if postulacion %}Guardar Cambios{% else %}Crear Postulación{% endif %}
                </button>
                
                {% if postulacion %}
                <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
                {% endif %}
                
                <a href="{% if postulacion %}/postulaciones/{{ postulacion.id }}{% else %}/postulaciones{% endif %}" class="btn btn-secondary">
                    Cancelar
                </a>
            </div>
        </form>

        {% if postulacion %}
        <form id="deleteForm" method="post" action="/postulaciones/{{ postulacion.id }}/eliminar" style="display:none;"></form>
        {% endif %}
    </div>
</div>

<script>
function confirmDelete() {
    if (confirm('¿Estás seguro de que deseas eliminar esta postulación? Esta acción no se puede deshacer.')) {
        document.getElementById('deleteForm').submit();
    }
}

// Set default date to today if creating new
{% if not postulacion %}
document.getElementById('fecha_postulacion').valueAsDate = new Date();
{% endif %}
</script>
{% endblock %}

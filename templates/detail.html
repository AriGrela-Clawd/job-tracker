{% extends "base.html" %}

{% block title %}{{ postulacion.empresa }} - {{ postulacion.puesto }}{% endblock %}

{% block content %}
<div class="container">
    <!-- Header -->
    <div class="detail-header">
        <div class="detail-title">
            <h1>{{ postulacion.puesto }}</h1>
            <div class="company-line">
                <span class="company-name">
                    <i class="fas fa-building"></i> {{ postulacion.empresa }}
                </span>
                <span class="status-badge status-{{ postulacion.estado.lower().replace(' ', '-') }} large">
                    {{ postulacion.estado }}
                </span>
            </div>
        </div>
        <div class="detail-actions">
            <a href="/postulaciones/{{ postulacion.id }}/editar" class="btn btn-warning">
                <i class="fas fa-edit"></i> Editar
            </a>
            <a href="/postulaciones" class="btn btn-secondary">
                <i class="fas fa-list"></i> Lista
            </a>
        </div>
    </div>

    <!-- Quick Status Change -->
    <div class="status-change-bar">
        <span>Cambiar estado:</span>
        <div class="status-buttons">
            {% for e in estados %}
            {% if e != postulacion.estado %}
            <form method="post" action="/postulaciones/{{ postulacion.id }}/cambiar-estado" class="inline-form">
                <input type="hidden" name="nuevo_estado" value="{{ e }}">
                <button type="submit" class="btn btn-sm btn-status status-{{ e.lower().replace(' ', '-') }}">
                    {{ e }}
                </button>
            </form>
            {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Main Info Grid -->
    <div class="detail-grid">
        <!-- Left Column: Main Info -->
        <div class="detail-main">
            <div class="detail-card">
                <h3><i class="fas fa-info-circle"></i> Información General</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <label>Fecha de postulación</label>
                        <value>{{ postulacion.fecha_postulacion.strftime('%d/%m/%Y') if postulacion.fecha_postulacion else '-' }}</value>
                    </div>
                    
                    <div class="info-item">
                        <label>Fecha de seguimiento</label>
                        <value {% if postulacion.fecha_seguimiento and postulacion.fecha_seguimiento <= now().date() %}class="text-warning"{% endif %}>
                            {{ postulacion.fecha_seguimiento.strftime('%d/%m/%Y') if postulacion.fecha_seguimiento else 'No establecida' }}
                            {% if postulacion.fecha_seguimiento and postulacion.fecha_seguimiento <= now().date() %}
                            <i class="fas fa-exclamation-triangle"></i>
                            {% endif %}
                        </value>
                    </div>
                    
                    <div class="info-item">
                        <label>Fecha de respuesta</label>
                        <value>{{ postulacion.fecha_respuesta.strftime('%d/%m/%Y') if postulacion.fecha_respuesta else 'Sin respuesta' }}</value>
                    </div>
                    
                    {% if postulacion.ubicacion %}
                    <div class="info-item">
                        <label>Ubicación</label>
                        <value><i class="fas fa-map-marker-alt"></i> {{ postulacion.ubicacion }}</value>
                    </div>
                    {% endif %}
                    
                    {% if postulacion.modalidad %}
                    <div class="info-item">
                        <label>Modalidad</label>
                        <value>
                            <span class="badge badge-info">{{ postulacion.modalidad }}</span>
                        </value>
                    </div>
                    {% endif %}
                    
                    {% if postulacion.salario_ofrecido %}
                    <div class="info-item">
                        <label>Salario</label>
                        <value><i class="fas fa-dollar-sign"></i> {{ postulacion.salario_ofrecido }}</value>
                    </div>
                    {% endif %}
                </div>
            </div>

            {% if postulacion.url_oferta %}
            <div class="detail-card">
                <h3><i class="fas fa-link"></i> Enlace de la Oferta</h3>
                <a href="{{ postulacion.url_oferta }}" target="_blank" class="link-box">
                    <i class="fas fa-external-link-alt"></i>
                    <span>{{ postulacion.url_oferta }}</span>
                </a>
            </div>
            {% endif %}

            <div class="detail-card">
                <h3><i class="fas fa-sticky-note"></i> Notas</h3>
                {% if postulacion.notas %}
                <div class="notes-content">
                    {{ postulacion.notas | replace('\n', '<br>') | safe }}
                </div>
                {% else %}
                <p class="text-muted">No hay notas registradas</p>
                {% endif %}
            </div>
        </div>

        <!-- Right Column: Contact & Tags -->
        <div class="detail-sidebar">
            {% if postulacion.contacto_nombre or postulacion.contacto_email %}
            <div class="detail-card">
                <h3><i class="fas fa-address-card"></i> Contacto</h3>
                {% if postulacion.contacto_nombre %}
                <div class="contact-item">
                    <i class="fas fa-user"></i>
                    <span>{{ postulacion.contacto_nombre }}</span>
                </div>
                {% endif %}
                {% if postulacion.contacto_email %}
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <a href="mailto:{{ postulacion.contacto_email }}">{{ postulacion.contacto_email }}</a>
                </div>
                {% endif %}
            </div>
            {% endif %}

            {% if postulacion.tags %}
            <div class="detail-card">
                <h3><i class="fas fa-tags"></i> Tags</h3>
                <div class="tags-list">
                    {% for tag in postulacion.tags.split(',') %}
                    <span class="tag">{{ tag.strip() }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Timeline -->
            <div class="detail-card">
                <h3><i class="fas fa-history"></i> Timeline</h3>
                <div class="timeline">
                    <div class="timeline-item active">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <strong>Postulado</strong>
                            <span>{{ postulacion.fecha_postulacion.strftime('%d/%m/%Y') if postulacion.fecha_postulacion else '-' }}</span>
                        </div>
                    </div>
                    
                    {% if postulacion.fecha_seguimiento %}
                    <div class="timeline-item {% if postulacion.fecha_seguimiento <= now().date() %}active{% endif %}">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <strong>Seguimiento</strong>
                            <span>{{ postulacion.fecha_seguimiento.strftime('%d/%m/%Y') }}</span>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if postulacion.fecha_respuesta %}
                    <div class="timeline-item active">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <strong>Respuesta</strong>
                            <span>{{ postulacion.fecha_respuesta.strftime('%d/%m/%Y') }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Meta Info -->
            <div class="detail-card meta-card">
                <small class="text-muted">
                    <i class="fas fa-clock"></i> 
                    Creado: {{ postulacion.created_at.strftime('%d/%m/%Y %H:%M') if postulacion.created_at else '-' }}
                </small>
                <br>
                <small class="text-muted">
                    <i class="fas fa-edit"></i>
                    Actualizado: {{ postulacion.updated_at.strftime('%d/%m/%Y %H:%M') if postulacion.updated_at else '-' }}
                </small>
            </div>
        </div>
    </div>
</div>
{% endblock %}
